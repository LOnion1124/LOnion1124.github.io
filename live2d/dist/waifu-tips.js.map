{"version":3,"file":"waifu-tips.js","sources":["../build/utils.js","../build/message.js","../build/logger.js","../build/model.js","../build/widget.js","../build/waifu-tips.js"],"sourcesContent":["function randomSelection(obj) {\n    return Array.isArray(obj) ? obj[Math.floor(Math.random() * obj.length)] : obj;\n}\nfunction randomOtherOption(total, excludeIndex) {\n    const idx = Math.floor(Math.random() * (total - 1));\n    return idx >= excludeIndex ? idx + 1 : idx;\n}\nfunction loadExternalResource(url, type) {\n    return new Promise((resolve, reject) => {\n        let tag;\n        if (type === 'css') {\n            tag = document.createElement('link');\n            tag.rel = 'stylesheet';\n            tag.href = url;\n        }\n        else if (type === 'js') {\n            tag = document.createElement('script');\n            tag.src = url;\n        }\n        if (tag) {\n            tag.onload = () => resolve(url);\n            tag.onerror = () => reject(url);\n            document.head.appendChild(tag);\n        }\n    });\n}\nexport { randomSelection, loadExternalResource, randomOtherOption };\n","import { randomSelection } from './utils.js';\nlet messageTimer = null;\nfunction showMessage(text, timeout, priority, override = true) {\n    let currentPriority = parseInt(sessionStorage.getItem('waifu-message-priority'), 10);\n    if (isNaN(currentPriority)) {\n        currentPriority = 0;\n    }\n    if (!text ||\n        (override && currentPriority > priority) ||\n        (!override && currentPriority >= priority))\n        return;\n    if (messageTimer) {\n        clearTimeout(messageTimer);\n        messageTimer = null;\n    }\n    text = randomSelection(text);\n    sessionStorage.setItem('waifu-message-priority', String(priority));\n    const tips = document.getElementById('waifu-tips');\n    tips.innerHTML = text;\n    tips.classList.add('waifu-tips-active');\n    messageTimer = setTimeout(() => {\n        sessionStorage.removeItem('waifu-message-priority');\n        tips.classList.remove('waifu-tips-active');\n    }, timeout);\n}\nfunction welcomeMessage(time, welcomeTemplate, referrerTemplate) {\n    if (location.pathname === '/') {\n        for (const { hour, text } of time) {\n            const now = new Date(), after = hour.split('-')[0], before = hour.split('-')[1] || after;\n            if (Number(after) <= now.getHours() &&\n                now.getHours() <= Number(before)) {\n                return text;\n            }\n        }\n    }\n    if (!welcomeTemplate)\n        return '';\n    const text = i18n(welcomeTemplate, document.title);\n    if (document.referrer === '' || !referrerTemplate)\n        return text;\n    const referrer = new URL(document.referrer);\n    if (location.hostname === referrer.hostname)\n        return text;\n    return `${i18n(referrerTemplate, referrer.hostname)}<br>${text}`;\n}\nfunction i18n(template, ...args) {\n    return template.replace(/\\$(\\d+)/g, (_, idx) => {\n        var _a;\n        const i = parseInt(idx, 10) - 1;\n        return (_a = args[i]) !== null && _a !== void 0 ? _a : '';\n    });\n}\nexport { showMessage, welcomeMessage, i18n };\n","class Logger {\n    constructor(level = 'info') {\n        this.level = level;\n    }\n    setLevel(level) {\n        if (!level)\n            return;\n        this.level = level;\n    }\n    shouldLog(level) {\n        return Logger.levelOrder[level] <= Logger.levelOrder[this.level];\n    }\n    error(message, ...args) {\n        if (this.shouldLog('error')) {\n            console.error('[Live2D Widget][ERROR]', message, ...args);\n        }\n    }\n    warn(message, ...args) {\n        if (this.shouldLog('warn')) {\n            console.warn('[Live2D Widget][WARN]', message, ...args);\n        }\n    }\n    info(message, ...args) {\n        if (this.shouldLog('info')) {\n            console.log('[Live2D Widget][INFO]', message, ...args);\n        }\n    }\n    trace(message, ...args) {\n        if (this.shouldLog('trace')) {\n            console.log('[Live2D Widget][TRACE]', message, ...args);\n        }\n    }\n}\nLogger.levelOrder = {\n    error: 0,\n    warn: 1,\n    info: 2,\n    trace: 3,\n};\nconst logger = new Logger();\nexport default logger;\n","import { showMessage } from './message.js';\nimport { loadExternalResource, randomOtherOption } from './utils.js';\nimport logger from './logger.js';\nclass ModelManager {\n    constructor(config, models = []) {\n        var _a;\n        this.modelList = null;\n        let { apiPath, cdnPath } = config;\n        const { cubism2Path, cubism5Path } = config;\n        let useCDN = false;\n        if (typeof cdnPath === 'string') {\n            if (!cdnPath.endsWith('/'))\n                cdnPath += '/';\n            useCDN = true;\n        }\n        else if (typeof apiPath === 'string') {\n            if (!apiPath.endsWith('/'))\n                apiPath += '/';\n            cdnPath = apiPath;\n            useCDN = true;\n            logger.warn('apiPath option is deprecated. Please use cdnPath instead.');\n        }\n        else if (!models.length) {\n            throw 'Invalid initWidget argument!';\n        }\n        let modelId = parseInt(localStorage.getItem('modelId'), 10);\n        let modelTexturesId = parseInt(localStorage.getItem('modelTexturesId'), 10);\n        if (isNaN(modelId) || isNaN(modelTexturesId)) {\n            modelTexturesId = 0;\n        }\n        if (isNaN(modelId)) {\n            modelId = (_a = config.modelId) !== null && _a !== void 0 ? _a : 0;\n        }\n        this.useCDN = useCDN;\n        this.cdnPath = cdnPath || '';\n        this.cubism2Path = cubism2Path || '';\n        this.cubism5Path = cubism5Path || '';\n        this._modelId = modelId;\n        this._modelTexturesId = modelTexturesId;\n        this.currentModelVersion = 0;\n        this.loading = false;\n        this.modelJSONCache = {};\n        this.models = models;\n    }\n    static async initCheck(config, models = []) {\n        const model = new ModelManager(config, models);\n        if (model.useCDN) {\n        }\n        else {\n            if (model.modelId >= model.models.length) {\n                model.modelId = 0;\n            }\n            if (model.modelTexturesId >= model.models[model.modelId].paths.length) {\n                model.modelTexturesId = 0;\n            }\n        }\n        return model;\n    }\n    set modelId(modelId) {\n        this._modelId = modelId;\n        localStorage.setItem('modelId', modelId.toString());\n    }\n    get modelId() {\n        return this._modelId;\n    }\n    set modelTexturesId(modelTexturesId) {\n        this._modelTexturesId = modelTexturesId;\n        localStorage.setItem('modelTexturesId', modelTexturesId.toString());\n    }\n    get modelTexturesId() {\n        return this._modelTexturesId;\n    }\n    resetCanvas() {\n        document.getElementById('waifu-canvas').innerHTML = '<canvas id=\"live2d\" width=\"800\" height=\"800\"></canvas>';\n    }\n    async fetchWithCache(url) {\n        let result;\n        if (url in this.modelJSONCache) {\n            result = this.modelJSONCache[url];\n        }\n        else {\n            try {\n                const response = await fetch(url);\n                result = await response.json();\n            }\n            catch (_a) {\n                result = null;\n            }\n            this.modelJSONCache[url] = result;\n        }\n        return result;\n    }\n    checkModelVersion(modelSetting) {\n        if (modelSetting.Version === 3 || modelSetting.FileReferences) {\n            return 3;\n        }\n        return 2;\n    }\n    async loadLive2D(modelSettingPath, modelSetting) {\n        if (this.loading) {\n            logger.warn('Still loading. Abort.');\n            return;\n        }\n        this.loading = true;\n        try {\n            const version = this.checkModelVersion(modelSetting);\n            if (version === 2) {\n                if (!this.cubism2model) {\n                    if (!this.cubism2Path) {\n                        logger.error('No cubism2Path set, cannot load Cubism 2 Core.');\n                        return;\n                    }\n                    await loadExternalResource(this.cubism2Path, 'js');\n                    const { default: Cubism2Model } = await import('./cubism2/index.js');\n                    this.cubism2model = new Cubism2Model();\n                }\n                if (this.currentModelVersion === 3) {\n                    this.cubism5model.release();\n                    this.resetCanvas();\n                }\n                if (this.currentModelVersion === 3 || !this.cubism2model.gl) {\n                    await this.cubism2model.init('live2d', modelSettingPath, modelSetting);\n                }\n                else {\n                    await this.cubism2model.changeModelWithJSON(modelSettingPath, modelSetting);\n                }\n            }\n            else {\n            }\n            logger.info(`Model ${modelSettingPath} (Cubism version ${version}) loaded`);\n            this.currentModelVersion = version;\n        }\n        catch (err) {\n            console.error('loadLive2D failed', err);\n        }\n        this.loading = false;\n    }\n    async loadTextureCache(modelName) {\n        const textureCache = await this.fetchWithCache(`${this.cdnPath}model/${modelName}/textures.cache`);\n        return textureCache || [];\n    }\n    async loadModel(message) {\n        let modelSettingPath, modelSetting;\n        if (this.useCDN) {\n        }\n        else {\n            modelSettingPath = this.models[this.modelId].paths[this.modelTexturesId];\n            modelSetting = await this.fetchWithCache(modelSettingPath);\n        }\n        await this.loadLive2D(modelSettingPath, modelSetting);\n        showMessage(message, 4000, 10);\n    }\n    async loadRandTexture(successMessage = '', failMessage = '') {\n        const { modelId } = this;\n        let noTextureAvailable = false;\n        if (this.useCDN) {\n        }\n        else {\n            if (this.models[modelId].paths.length === 1) {\n                noTextureAvailable = true;\n            }\n            else {\n                this.modelTexturesId = randomOtherOption(this.models[modelId].paths.length, this.modelTexturesId);\n            }\n        }\n        if (noTextureAvailable) {\n            showMessage(failMessage, 4000, 10);\n        }\n        else {\n            await this.loadModel(successMessage);\n        }\n    }\n    async loadNextModel() {\n        this.modelTexturesId = 0;\n        if (this.useCDN) {\n            this.modelId = (this.modelId + 1) % this.modelList.models.length;\n            await this.loadModel(this.modelList.messages[this.modelId]);\n        }\n        else {\n            this.modelId = (this.modelId + 1) % this.models.length;\n            await this.loadModel(this.models[this.modelId].message);\n        }\n    }\n}\nexport { ModelManager };\n","import { ModelManager } from './model.js';\nimport { showMessage, welcomeMessage } from './message.js';\nimport { randomSelection } from './utils.js';\nimport logger from './logger.js';\nfunction registerEventListener(tips) {\n    let userAction = false;\n    let userActionTimer;\n    const messageArray = tips.message.default;\n    tips.seasons.forEach(({ date, text }) => {\n        const now = new Date(), after = date.split('-')[0], before = date.split('-')[1] || after;\n        if (Number(after.split('/')[0]) <= now.getMonth() + 1 &&\n            now.getMonth() + 1 <= Number(before.split('/')[0]) &&\n            Number(after.split('/')[1]) <= now.getDate() &&\n            now.getDate() <= Number(before.split('/')[1])) {\n            text = randomSelection(text);\n            text = text.replace('{year}', String(now.getFullYear()));\n            messageArray.push(text);\n        }\n    });\n    let lastHoverElement;\n    window.addEventListener('mousemove', () => (userAction = true));\n    window.addEventListener('keydown', () => (userAction = true));\n    setInterval(() => {\n        if (userAction) {\n            userAction = false;\n            clearInterval(userActionTimer);\n            userActionTimer = null;\n        }\n        else if (!userActionTimer) {\n            userActionTimer = setInterval(() => {\n                showMessage(messageArray, 6000, 9);\n            }, 20000);\n        }\n    }, 1000);\n    window.addEventListener('mouseover', (event) => {\n        var _a;\n        for (let { selector, text } of tips.mouseover) {\n            if (!((_a = event.target) === null || _a === void 0 ? void 0 : _a.closest(selector)))\n                continue;\n            if (lastHoverElement === selector)\n                return;\n            lastHoverElement = selector;\n            text = randomSelection(text);\n            text = text.replace('{text}', event.target.innerText);\n            showMessage(text, 4000, 8);\n            return;\n        }\n    });\n    window.addEventListener('click', (event) => {\n        var _a;\n        for (let { selector, text } of tips.click) {\n            if (!((_a = event.target) === null || _a === void 0 ? void 0 : _a.closest(selector)))\n                continue;\n            text = randomSelection(text);\n            text = text.replace('{text}', event.target.innerText);\n            showMessage(text, 4000, 8);\n            return;\n        }\n    });\n    window.addEventListener('live2d:hoverbody', () => {\n        const text = randomSelection(tips.message.hoverBody);\n        showMessage(text, 4000, 8, false);\n    });\n    window.addEventListener('live2d:tapbody', () => {\n        const text = randomSelection(tips.message.tapBody);\n        showMessage(text, 4000, 9);\n    });\n    const devtools = () => { };\n    console.log('%c', devtools);\n    devtools.toString = () => {\n        showMessage(tips.message.console, 6000, 9);\n    };\n    window.addEventListener('copy', () => {\n        showMessage(tips.message.copy, 6000, 9);\n    });\n    window.addEventListener('visibilitychange', () => {\n        if (!document.hidden)\n            showMessage(tips.message.visibilitychange, 6000, 9);\n    });\n}\nasync function loadWidget(config) {\n    var _a;\n    sessionStorage.removeItem('waifu-message-priority');\n    let models = [];\n    let tips;\n    if (config.waifuPath) {\n        const response = await fetch(config.waifuPath);\n        tips = await response.json();\n        models = tips.models;\n        registerEventListener(tips);\n        showMessage(welcomeMessage(tips.time, tips.message.welcome, tips.message.referrer), 7000, 11);\n    }\n    const model = await ModelManager.initCheck(config, models);\n    await model.loadModel('');\n    (_a = document.getElementById('waifu')) === null || _a === void 0 ? void 0 : _a.classList.add('waifu-active');\n}\nfunction initWidget(config) {\n    if (typeof config === 'string') {\n        logger.error('Your config for Live2D initWidget is outdated. Please refer to https://github.com/stevenjoezhang/live2d-widget/blob/master/dist/autoload.js');\n        return;\n    }\n    logger.setLevel(config.logLevel);\n    const toggle = document.getElementById('waifu-toggle');\n    if (!toggle) {\n        logger.warn('No #waifu-toggle element found. Add a fixed button in your HTML to toggle the widget.');\n    }\n    toggle === null || toggle === void 0 ? void 0 : toggle.addEventListener('click', async () => {\n        const waifu = document.getElementById('waifu');\n        if (!waifu)\n            return;\n        const isVisible = waifu.classList.contains('waifu-active') && !waifu.classList.contains('waifu-hidden');\n        if (isVisible) {\n            if (config.waifuPath) {\n                try {\n                    const response = await fetch(config.waifuPath);\n                    const tips = await response.json();\n                    showMessage(tips.message.goodbye, 2000, 11);\n                }\n                catch (e) {\n                }\n            }\n            waifu.classList.remove('waifu-active');\n            waifu.classList.add('waifu-hidden');\n        }\n        else {\n            waifu.classList.remove('waifu-hidden');\n            setTimeout(() => {\n                waifu.classList.add('waifu-active');\n            }, 0);\n        }\n    });\n    console.log(\"loading widget\");\n    loadWidget(config);\n}\nexport { initWidget };\n","import { initWidget } from './widget.js';\nwindow.initWidget = initWidget;\n"],"names":["randomSelection","obj","Array","isArray","Math","floor","random","length","messageTimer","showMessage","text","timeout","priority","override","currentPriority","parseInt","sessionStorage","getItem","isNaN","clearTimeout","setItem","String","tips","document","getElementById","innerHTML","classList","add","setTimeout","removeItem","remove","i18n","template","args","replace","_","idx","_a","i","Logger","constructor","level","this","setLevel","shouldLog","levelOrder","error","message","console","warn","info","log","trace","logger","ModelManager","config","models","modelList","apiPath","cdnPath","cubism2Path","cubism5Path","useCDN","endsWith","modelId","localStorage","modelTexturesId","_modelId","_modelTexturesId","currentModelVersion","loading","modelJSONCache","initCheck","model","paths","toString","resetCanvas","fetchWithCache","url","result","response","fetch","json","checkModelVersion","modelSetting","Version","FileReferences","loadLive2D","modelSettingPath","version","cubism2model","Promise","resolve","reject","tag","createElement","src","onload","onerror","head","appendChild","default","Cubism2Model","import","cubism5model","release","gl","changeModelWithJSON","init","err","loadTextureCache","modelName","loadModel","loadRandTexture","successMessage","failMessage","noTextureAvailable","total","excludeIndex","randomOtherOption","loadNextModel","messages","async","loadWidget","waifuPath","userActionTimer","userAction","messageArray","lastHoverElement","seasons","forEach","date","now","Date","after","split","before","Number","getMonth","getDate","getFullYear","push","window","addEventListener","setInterval","clearInterval","event","selector","mouseover","target","closest","innerText","click","hoverBody","tapBody","devtools","copy","hidden","visibilitychange","registerEventListener","time","welcomeTemplate","referrerTemplate","location","pathname","hour","getHours","title","referrer","URL","hostname","welcomeMessage","welcome","initWidget","logLevel","toggle","waifu","contains","goodbye","e"],"mappings":"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"}